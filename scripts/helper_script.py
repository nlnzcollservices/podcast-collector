from alma_tools import AlmaTools
import pymarc
import io
with open(r"Y:\ndha\pre-deposit_prod\LD_working\podcasts\assets\new_podcasts_08_2022.txt", "r") as f:
	data= f.read()
new_dict = {}
#"A Neesh audience" : {'rss_filename': 'https://www.spreaker.com/show/4467635/episodes/feed', 'url': 'https://www.spreaker.com/show/a-neesh-audience', 'serial_mms': '9918987273002836', 'serial_pol': 'POL-126894', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Neesh_audience.xml'} ,

for el in data.split("\n")[:-1]:
	print(el)
	el = el.replace("â€™","'")
	print(el.split(" ")[-1])
	print(" ".join(el.split(" ")[:-3]))
	# print(el)
	new_dict[" ".join(el.split(" ")[:-3])]={'rss_filename': None, 'url': None, 'serial_mms': el.split(" ")[-1], 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': "mis_Podcast_"+"_".join("mis_Podcast_"el.split(" ")[:-3]).replace("'","").replace("&","and").replace(".","") + ".xml"} 
print(new_dict)
#{"Paige's space": {'rss_filename': None, 'url': None, 'serial_mms': '9919014268502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Pocast_Paiges_space.xml'}, 'Mud & blood': {'rss_filename': None, 'url': None, 'serial_mms': '9919015065102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Mud_&_blood.xml'}, 'Going viral': {'rss_filename': None, 'url': None, 'serial_mms': '9919015065202836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Going_viral.xml'}, 'Hauraki drive': {'rss_filename': None, 'url': None, 'serial_mms': '9919046358302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Hauraki_drive.xml'}, 'Bhuja podcast': {'rss_filename': None, 'url': None, 'serial_mms': '9919016171502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bhuja_podcast.xml'}, "Dr. Tennant's verbal highs": {'rss_filename': None, 'url': None, 'serial_mms': '9919014268602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Dr._Tennants_verbal_highs.xml'}, 'Brazen': {'rss_filename': None, 'url': None, 'serial_mms': '9919014268202836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Brazen.xml'}, 'Stag roar': {'rss_filename': None, 'url': None, 'serial_mms': '9919009964602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Stag_roar.xml'}, 'Purpose fuelled performance': {'rss_filename': None, 'url': None, 'serial_mms': '9919009965002836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Purpose_fuelled_performance.xml'}, 'What comes after what comes next': {'rss_filename': None, 'url': None, 'serial_mms': '9918993467902836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_What_comes_after_what_comes_next.xml'}, 'Politics in full sentences': {'rss_filename': None, 'url': None, 'serial_mms': '9918994269102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Politics_in_full_sentences.xml'}, 'Kelli from the Tron': {'rss_filename': None, 'url': None, 'serial_mms': '9918991865302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Kelli_from_the_Tron.xml'}, 'Conversations that count': {'rss_filename': None, 'url': None, 'serial_mms': '9918991865902836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Conversations_that_count.xml'}, 'Bosses rebuilding': {'rss_filename': None, 'url': None, 'serial_mms': '9918991867602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bosses_rebuilding.xml'}, 'Bosses in lockdown': {'rss_filename': None, 'url': None, 'serial_mms': '9919046368102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bosses_in_lockdown.xml'}, 'Few good men': {'rss_filename': None, 'url': None, 'serial_mms': '9918991871502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Few_good_men.xml'}, 'New Zealand Initiative': {'rss_filename': None, 'url': None, 'serial_mms': '9918965671302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_New_Zealand_Initiative.xml'}, "SH People's Politburo": {'rss_filename': None, 'url': None, 'serial_mms': '9918965671002836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_SH_Peoples_Politburo.xml'}, 'Kiwi birth tales': {'rss_filename': None, 'url': None, 'serial_mms': '9918965671502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Kiwi_birth_tales.xml'}}
temp=sorted(new_dict)
new_dict = dict([(k,new_dict[k]) for i,k in enumerate(temp)])
#{'Bhuja podcast': {'rss_filename': None, 'url': None, 'serial_mms': '9919016171502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bhuja_podcast.xml'}, 'Bosses in lockdown': {'rss_filename': None, 'url': None, 'serial_mms': '9919046368102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bosses_in_lockdown.xml'}, 'Bosses rebuilding': {'rss_filename': None, 'url': None, 'serial_mms': '9918991867602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bosses_rebuilding.xml'}, 'Brazen': {'rss_filename': None, 'url': None, 'serial_mms': '9919014268202836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Brazen.xml'}, 'Conversations that count': {'rss_filename': None, 'url': None, 'serial_mms': '9918991865902836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Conversations_that_count.xml'}, "Dr. Tennant's verbal highs": {'rss_filename': None, 'url': None, 'serial_mms': '9919014268602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Dr._Tennants_verbal_highs.xml'}, 'Few good men': {'rss_filename': None, 'url': None, 'serial_mms': '9918991871502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Few_good_men.xml'}, 'Going viral': {'rss_filename': None, 'url': None, 'serial_mms': '9919015065202836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Going_viral.xml'}, 'Hauraki drive': {'rss_filename': None, 'url': None, 'serial_mms': '9919046358302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Hauraki_drive.xml'}, 'Kelli from the Tron': {'rss_filename': None, 'url': None, 'serial_mms': '9918991865302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Kelli_from_the_Tron.xml'}, 'Kiwi birth tales': {'rss_filename': None, 'url': None, 'serial_mms': '9918965671502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Kiwi_birth_tales.xml'}, 'Mud & blood': {'rss_filename': None, 'url': None, 'serial_mms': '9919015065102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Mud_and_blood.xml'}, 'New Zealand Initiative': {'rss_filename': None, 'url': None, 'serial_mms': '9918965671302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_New_Zealand_Initiative.xml'}, "Paige's space": {'rss_filename': None, 'url': None, 'serial_mms': '9919014268502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Pocast_Paiges_space.xml'}, 'Politics in full sentences': {'rss_filename': None, 'url': None, 'serial_mms': '9918994269102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Politics_in_full_sentences.xml'}, 'Purpose fuelled performance': {'rss_filename': None, 'url': None, 'serial_mms': '9919009965002836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Purpose_fuelled_performance.xml'}, "SH People's Politburo": {'rss_filename': None, 'url': None, 'serial_mms': '9918965671002836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_SH_Peoples_Politburo.xml'}, 'Stag roar': {'rss_filename': None, 'url': None, 'serial_mms': '9919009964602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Stag_roar.xml'}, 'What comes after what comes next': {'rss_filename': None, 'url': None, 'serial_mms': '9918993467902836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_What_comes_after_what_comes_next.xml'}}

print(new_dict)
for el in new_dict.keys():
	my_alma = AlmaTools("prod")
	# print(help(my_alma))
	# quit()
	my_alma.get_bib(new_dict[el]["serial_mms"])
	#print(my_alma.xml_response_data)
	my_rec = pymarc.parse_xml_to_array(io.StringIO(my_alma.xml_response_data))[0]
	try:
		print("here1")
		new_dict[el]["url"] = my_rec["856"].value()
	except:
		print(my_rec)
		prnt("here2")
#{'Bhuja podcast': {'rss_filename': None, 'url': 'https://www.spreaker.com/show/going-viral', 'serial_mms': '9919016171502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bhuja_podcast.xml'}, 'Bosses in lockdown': {'rss_filename': None, 'url': 'https://www.spreaker.com/show/bosses-in-lockdown', 'serial_mms': '9919046368102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bosses_in_lockdown.xml'}, 'Bosses rebuilding': {'rss_filename': None, 'url': 'https://www.spreaker.com/show/bosses-in-lockdown', 'serial_mms': '9918991867602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Bosses_rebuilding.xml'}, 'Brazen': {'rss_filename': None, 'url': 'https://podcasts.apple.com/nz/podcast/brazen/id1499604679', 'serial_mms': '9919014268202836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Brazen.xml'}, 'Conversations that count': {'rss_filename': None, 'url': 'https://thespinoff.co.nz/podcast-series/conversations-that-count/', 'serial_mms': '9918991865902836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Conversations_that_count.xml'}, "Dr. Tennant's verbal highs": {'rss_filename': None, 'url': 'https://www.verbalhighs.com/', 'serial_mms': '9919014268602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Dr_Tennants_verbal_highs.xml'}, 'Few good men': {'rss_filename': None, 'url': 'https://www.spreaker.com/show/a-few-good-men', 'serial_mms': '9918991871502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Few_good_men.xml'}, 'Going viral': {'rss_filename': None, 'url': 'https://www.spreaker.com/show/going-viral', 'serial_mms': '9919015065202836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Going_viral.xml'}, 'Hauraki drive': {'rss_filename': None, 'url': None, 'serial_mms': '9919046358302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Hauraki_drive.xml'}, 'Kelli from the Tron': {'rss_filename': None, 'url': 'https://kellifromthetron.co.nz/free-fm-show/', 'serial_mms': '9918991865302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Kelli_from_the_Tron.xml'}, 'Kiwi birth tales': {'rss_filename': None, 'url': 'https://www.kiwibirthtales.com/birth-tales-episodes', 'serial_mms': '9918965671502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Kiwi_birth_tales.xml'}, 'Mud & blood': {'rss_filename': None, 'url': 'https://9littlebees.com/mudandbloodcast/', 'serial_mms': '9919015065102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Mud_and_blood.xml'}, 'New Zealand Initiative': {'rss_filename': None, 'url': 'https://www.nzinitiative.org.nz/reports-and-media/podcasts/', 'serial_mms': '9918965671302836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_New_Zealand_Initiative.xml'}, "Paige's space": {'rss_filename': None, 'url': 'https://www.paiges.space/#podcast', 'serial_mms': '9919014268502836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Pocast_Paiges_space.xml'}, 'Politics in full sentences': {'rss_filename': None, 'url': 'https://podcasts.apple.com/nz/podcast/id1468640390', 'serial_mms': '9918994269102836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Politics_in_full_sentences.xml'}, 'Purpose fuelled performance': {'rss_filename': None, 'url': 'https://www.growgood.co/podcast', 'serial_mms': '9919009965002836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Purpose_fuelled_performance.xml'}, "SH People's Politburo": {'rss_filename': None, 'url': 'https://peoplespolitburo.com/blog/page/1/', 'serial_mms': '9918965671002836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_SH_Peoples_Politburo.xml'}, 'Stag roar': {'rss_filename': None, 'url': 'https://www.stagroar.co.nz/', 'serial_mms': '9919009964602836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_Stag_roar.xml'}, 'What comes after what comes next': {'rss_filename': None, 'url': 'https://podtail.com/en/podcast/what-comes-after-what-comes-next/', 'serial_mms': '9918993467902836', 'serial_pol': '', 'publish_link_ro_record': True, 'automated_flag': False, 'access_policy': '100', 'template_name': 'mis_Podcast_What_comes_after_what_comes_next.xml'}}

# for el in new_dict:
# 	print('"'+el+'"')
print(new_dict)