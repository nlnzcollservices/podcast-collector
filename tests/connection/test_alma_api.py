import pytest
import requests
import configparser

url = 'https://api-ap.hosted.exlibrisgroup.com/almaws/v1/bibs/9919172176102836'
secret_file = r"C:\Source\sercrets_and_credentials\secrets"
config = configparser.ConfigParser()
config.read(secret_file)

prod_key = config.get( "configuration", "production") 
sb_key= config.get("configuration", "sandbox")
expected_response = r"""<?xml version="1.0" encoding="UTF-8" standalone="yes"?><bib><mms_id>9919172176102836</mms_id><record_format>marc21</record_format><linked_record_id/><title>MAFS AU, week one.</title><author>Yee, Jane,</author><network_numbers><network_number>(OCoLC)1304492587</network_number></network_numbers><place_of_publication>[Auckland] :</place_of_publication><date_of_publication>[2022]</date_of_publication><publisher_const>[The Spinoff],</publisher_const><holdings link="https://api-ap.hosted.exlibrisgroup.com/almaws/v1/bibs/9919172176102836/holdings"/><created_by>exl_api</created_by><created_date>2022-02-14Z</created_date><last_modified_by>System</last_modified_by><last_modified_date>2023-01-09Z</last_modified_date><suppress_from_publishing>false</suppress_from_publishing><suppress_from_external_search>false</suppress_from_external_search><suppress_from_metadoor>false</suppress_from_metadoor><rank>85</rank><sync_with_oclc>BIBS</sync_with_oclc><sync_with_libraries_australia>NONE</sync_with_libraries_australia><originating_system>OTHER</originating_system><brief_level desc="10">10</brief_level><record><leader>02344cim a22004451i 4500</leader><controlfield tag="001">9919172176102836</controlfield><controlfield tag="005">20221212140210.0</controlfield><controlfield tag="006">m|||||o||h||||||||</controlfield><controlfield tag="007">cr ||a||||||||</controlfield><controlfield tag="007">sr |||||||||ed</controlfield><controlfield tag="008">220215s2022    nz ||nn o      ||   eng  </controlfield><datafield ind1=" " ind2=" " tag="035"><subfield code="a">(OCoLC)1304492587</subfield></datafield><datafield ind1=" " ind2=" " tag="040"><subfield code="a">Nz</subfield><subfield code="b">eng</subfield><subfield code="e">rda</subfield><subfield code="c">Nz</subfield></datafield><datafield ind1=" " ind2=" " tag="042"><subfield code="a">nznb</subfield></datafield><datafield ind1=" " ind2=" " tag="043"><subfield code="a">u-nz---</subfield></datafield><datafield ind1="1" ind2=" " tag="100"><subfield code="a">Yee, Jane,</subfield><subfield code="e">author.</subfield></datafield><datafield ind1="1" ind2="0" tag="245"><subfield code="a">MAFS AU, week one.</subfield></datafield><datafield ind1=" " ind2="1" tag="264"><subfield code="a">[Auckland] :</subfield><subfield code="b">[The Spinoff],</subfield><subfield code="c">[2022]</subfield></datafield><datafield ind1=" " ind2=" " tag="300"><subfield code="a">1 online resource (1 audio file)</subfield></datafield><datafield ind1=" " ind2=" " tag="336"><subfield code="a">spoken word</subfield><subfield code="2">rdacontent</subfield></datafield><datafield ind1=" " ind2=" " tag="337"><subfield code="a">computer</subfield><subfield code="2">rdamedia</subfield></datafield><datafield ind1=" " ind2=" " tag="338"><subfield code="a">online resource</subfield><subfield code="2">rdacarrier</subfield></datafield><datafield ind1=" " ind2=" " tag="344"><subfield code="a">digital</subfield><subfield code="2">rdatr</subfield></datafield><datafield ind1=" " ind2=" " tag="347"><subfield code="3">National Library of New Zealand archived copy</subfield><subfield code="a">audio file</subfield><subfield code="2">rdaft</subfield></datafield><datafield ind1=" " ind2=" " tag="347"><subfield code="3">National Library of New Zealand archived copy</subfield><subfield code="b">MP3</subfield></datafield><datafield ind1="1" ind2=" " tag="490"><subfield code="a">Real pod,</subfield><subfield code="x">[2624-4055] ;</subfield><subfield code="v">February 10, 2022</subfield></datafield><datafield ind1=" " ind2=" " tag="500"><subfield code="a">Archived by the National Library of New Zealand in MP3.</subfield><subfield code="5">Nz</subfield></datafield><datafield ind1=" " ind2=" " tag="500"><subfield code="a">Converted from audio files to streaming audio format.</subfield><subfield code="5">Nz</subfield></datafield><datafield ind1=" " ind2=" " tag="520"><subfield code="a">"To paraphrase the romantic poets Savage Garden, we knew we loved the new MAFS AU couples before we met them. Relive all the bungled cake cuts, clay-on-face clangers and honesty box horrors of week one as Anthony and Selin, Tamara and Brent, Domenica and Jack, Ella and Mitch, Andrew and Holly and Selina and Cody tie the knot. [This recap covers things that happened up to and including the episode airing on Thursday night in NZ.] See acast.com/privacy for privacy and opt-out information."--RSS feed.</subfield></datafield><datafield ind1=" " ind2=" " tag="588"><subfield code="a">Record automatically derived from RSS feed.</subfield><subfield code="5">Nz</subfield></datafield><datafield ind1=" " ind2="0" tag="650"><subfield code="a">Reality television programs.</subfield></datafield><datafield ind1=" " ind2="7" tag="655"><subfield code="a">Podcasts.</subfield><subfield code="2">lcgft</subfield></datafield><datafield ind1="1" ind2=" " tag="700"><subfield code="a">Greive, Duncan,</subfield><subfield code="e">author.</subfield></datafield><datafield ind1="1" ind2=" " tag="700"><subfield code="a">Casey, Alex,</subfield><subfield code="e">author.</subfield></datafield><datafield ind1="1" ind2=" " tag="800"><subfield code="a">Yee, Jane.</subfield><subfield code="t">Real pod ;</subfield><subfield code="v">February 10, 2022.</subfield></datafield><datafield ind1="4" ind2="0" tag="856"><subfield code="u">https://sphinx.acast.com/p/acast/s/the-real-pod/e/6204308345f29800141084ea/media.mp3</subfield></datafield><datafield ind1="4" ind2="2" tag="856"><subfield code="3">File host</subfield><subfield code="u">https://shows.acast.com/the-real-pod/episodes/real-recap-mafs-au-meet-the-couples</subfield></datafield><datafield ind1="4" ind2="0" tag="856"><subfield code="u">https://natlib-primo.hosted.exlibrisgroup.com/primo-explore/fulldisplay?docid=NLNZ_ALMA11377087760002836&amp;context=L&amp;vid=NLNZ&amp;search_scope=NLNZ&amp;tab=catalogue&amp;lang=en_US</subfield><subfield code="z">Archived copy available at the National Library of New Zealand</subfield><subfield code="x">Open Access</subfield></datafield><datafield ind1=" " ind2=" " tag="901"><subfield code="a">MGR</subfield></datafield><datafield ind1=" " ind2=" " tag="902"><subfield code="a">DNZ reharvest, May 16, 2022</subfield></datafield><datafield ind1=" " ind2=" " tag="942"><subfield code="a">nznb 2022-03</subfield></datafield></record></bib>
                    """

def test_alma_get_prod():

    """Testing alma get API with sb key"""
    params = {'apikey':  prod_key}
    r = requests.get(url, params=params, verify = False)
    assert r.text[:50] == pytest.approx(expected_response[:50], rel=0.2)

def test_alma_get_sb():

    """Testing alma get API with sb key"""

    params = {'apikey':  sb_key}
    r= requests.get(url, params=params, verify = False)
    assert r.text[:50] == pytest.approx(expected_response[:50], rel=0.2)